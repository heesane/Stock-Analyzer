# 데이터 및 지표 산출 방식

## 시세·기술 지표
- **데이터 수집**: `yfinance`에서 1년치 일별 캔들(`Close`, `High`, `Low`, `Volume`) 다운로드.
- **MACD**: 12/26 EMA 차이와 9일 시그널, 히스토그램 계산.
- **RSI**: 14일 상대강도지수, 0~100 범위를 Min-Max로 정규화.
- **가격 채널**: 회귀선과 잔차 표준편차로 상단/하단 추정 및 위치 판단.
- **이동평균 배열**: 5/20/60일 SMA 비교로 추세 가중치 산출.
- **거래량 스파이크**: 최근 5일 평균 대비 30일 평균을 z-score → 시그모이드 값.
- **변동성**: 30일 수익률 표준편차를 연율화, z-score 후 1 - sigmoid(z)로 value화.
- **52주 대비 위치**: 52주 최고가 대비 현재가 비율을 1-비율 형태로 사용.
- **ATR & 손절선**: 14일 평균실체범위를 기반으로 2×ATR 손절선 제안.

## 펀더멘털·뉴스
- **밸류에이션**: PER/PBR을 역수 기반으로 0~1 값으로 변환.
- **EPS 성장률**: 최근 2개 Net Income 값으로 성장률 계산 후 시그모이드 변환.
- **머니플로우**: 최근 5일 `(Close-Open)*Volume` 합계를 전체 절대값으로 나눠 [-1,1] → (value+1)/2.
- **뉴스 감성**: 7일 내 기사에서 긍/부정 키워드를 세어 비율(value)을 산출.

## 상대 성과 · 백테스트
- **Relative Strength**: 선택된 벤치마크(SPY 기본)와 60거래일 수익률 비교 → 알파(α)와 “우위/열위/중립” 라벨.
- **Backtest Summary**: 지정 기간의 buy & hold 수익률, 벤치마크 대비 알파, 일간 승률 계산.

## 스코어카드 파이프라인
1. **정규화**: 지표별로 z-score 또는 min-max로 표준화.
2. **Value 변환**: RSI→1-정규화, MACD/Volume→sigmoid(z), 변동성→1-sigmoid(z) 등 0~1 bullishness로 변환.
3. **가중 평균**: IndicatorDefinition에 정의된 weight를 활용해 value를 결합하고 총점을 0~1로 계산.
4. **등급**: 총점이 0.8 이상이면 강력 매수, 0.6 이상 매수, 0.4 이상 중립, 그 외 매도.
5. **구조**: `summary["scorecard"]`에 per-indicator value/weight, total_score(0~100), rating_label_key, category별 평균을 포함.
